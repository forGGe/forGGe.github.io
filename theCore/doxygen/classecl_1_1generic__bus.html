<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Project: ecl::generic_bus&lt; PBus &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classecl_1_1generic__bus.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">ecl::generic_bus&lt; PBus &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Generic bus interface.  
 <a href="classecl_1_1generic__bus.html#details">More...</a></p>

<p><code>#include &lt;/root/thecore/dev/bus/export/dev/bus.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a9a48ce41c43cd645b9a16b14f77c38c0"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a9a48ce41c43cd645b9a16b14f77c38c0">platform_handle</a> = PBus</td></tr>
<tr class="memdesc:a9a48ce41c43cd645b9a16b14f77c38c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Exported platform bus type.  <a href="#a9a48ce41c43cd645b9a16b14f77c38c0">More...</a><br /></td></tr>
<tr class="separator:a9a48ce41c43cd645b9a16b14f77c38c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a81353b994dedb7eadbb1a541da18354c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a81353b994dedb7eadbb1a541da18354c">generic_bus</a> ()=delete</td></tr>
<tr class="memdesc:a81353b994dedb7eadbb1a541da18354c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construction is not allowed.  <a href="#a81353b994dedb7eadbb1a541da18354c">More...</a><br /></td></tr>
<tr class="separator:a81353b994dedb7eadbb1a541da18354c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed14e010e70ab6b6a2da294a52e722b3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#aed14e010e70ab6b6a2da294a52e722b3">~generic_bus</a> ()=delete</td></tr>
<tr class="separator:aed14e010e70ab6b6a2da294a52e722b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:afad22a26f544e4ceed1acf2d36bc058a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#afad22a26f544e4ceed1acf2d36bc058a">init</a> ()</td></tr>
<tr class="memdesc:afad22a26f544e4ceed1acf2d36bc058a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inits a bus.  <a href="#afad22a26f544e4ceed1acf2d36bc058a">More...</a><br /></td></tr>
<tr class="separator:afad22a26f544e4ceed1acf2d36bc058a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0076b1fb7cd7e434a91cdca47542a4b1"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a0076b1fb7cd7e434a91cdca47542a4b1">deinit</a> ()</td></tr>
<tr class="memdesc:a0076b1fb7cd7e434a91cdca47542a4b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-inits a bus.  <a href="#a0076b1fb7cd7e434a91cdca47542a4b1">More...</a><br /></td></tr>
<tr class="separator:a0076b1fb7cd7e434a91cdca47542a4b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc62668bfb39f7d024cabab8520bd8fb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#abc62668bfb39f7d024cabab8520bd8fb">lock</a> ()</td></tr>
<tr class="memdesc:abc62668bfb39f7d024cabab8520bd8fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locks a bus.  <a href="#abc62668bfb39f7d024cabab8520bd8fb">More...</a><br /></td></tr>
<tr class="separator:abc62668bfb39f7d024cabab8520bd8fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a4d33e14bf412be321861a0e410aba0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a9a4d33e14bf412be321861a0e410aba0">unlock</a> ()</td></tr>
<tr class="memdesc:a9a4d33e14bf412be321861a0e410aba0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlocks a bus.  <a href="#a9a4d33e14bf412be321861a0e410aba0">More...</a><br /></td></tr>
<tr class="separator:a9a4d33e14bf412be321861a0e410aba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21e058a0ec65ba4e0f16fff023e9c086"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086">set_buffers</a> (const uint8_t *<a class="el" href="namespaceecl.html#ac81ff427233ee3d1e30483dd0f35d32aa7da685001e153f41a83eb6255069dc3d">tx</a>, uint8_t *<a class="el" href="namespaceecl.html#ac81ff427233ee3d1e30483dd0f35d32aa22770fbdd1177351a869401a0e1427bc">rx</a>, size_t size)</td></tr>
<tr class="memdesc:a21e058a0ec65ba4e0f16fff023e9c086"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets RX and TX buffers and their sizes.  <a href="#a21e058a0ec65ba4e0f16fff023e9c086">More...</a><br /></td></tr>
<tr class="separator:a21e058a0ec65ba4e0f16fff023e9c086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7874657f5e4b4b7f859b32c110907216"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a7874657f5e4b4b7f859b32c110907216">set_buffers</a> (const uint8_t *<a class="el" href="namespaceecl.html#ac81ff427233ee3d1e30483dd0f35d32aa7da685001e153f41a83eb6255069dc3d">tx</a>, uint8_t *<a class="el" href="namespaceecl.html#ac81ff427233ee3d1e30483dd0f35d32aa22770fbdd1177351a869401a0e1427bc">rx</a>, size_t tx_size, size_t rx_size)</td></tr>
<tr class="memdesc:a7874657f5e4b4b7f859b32c110907216"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets RX and TX buffers and their sizes.  <a href="#a7874657f5e4b4b7f859b32c110907216">More...</a><br /></td></tr>
<tr class="separator:a7874657f5e4b4b7f859b32c110907216"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae07b2883293ec5c6bdcaaebffa51b1b1"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#ae07b2883293ec5c6bdcaaebffa51b1b1">set_buffers</a> (size_t size, uint8_t fill_byte=0xff)</td></tr>
<tr class="memdesc:ae07b2883293ec5c6bdcaaebffa51b1b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets TX buffer size and fills it with given byte.  <a href="#ae07b2883293ec5c6bdcaaebffa51b1b1">More...</a><br /></td></tr>
<tr class="separator:ae07b2883293ec5c6bdcaaebffa51b1b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c7eed2b45da51f420d08649f156f253"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a4c7eed2b45da51f420d08649f156f253">xfer</a> (size_t *sent=nullptr, size_t *received=nullptr, std::chrono::milliseconds timeout=std::chrono::milliseconds::max())</td></tr>
<tr class="memdesc:a4c7eed2b45da51f420d08649f156f253"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs xfer in blocking mode using buffers set previously with optional timeout.  <a href="#a4c7eed2b45da51f420d08649f156f253">More...</a><br /></td></tr>
<tr class="separator:a4c7eed2b45da51f420d08649f156f253"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77af418d9dbd560b4745dc16133deeef"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a77af418d9dbd560b4745dc16133deeef">xfer</a> (const <a class="el" href="namespaceecl.html#ac1d657f13504c88de2aa1f36963fc64f">bus_handler</a> &amp;handler, <a class="el" href="namespaceecl.html#aca4194795dab8d7b9cdafce56172d9ce">async_type</a> type=<a class="el" href="namespaceecl.html#aca4194795dab8d7b9cdafce56172d9cea516ff1e73f558b0ae701ae4561a63e2c">async_type::immediate</a>)</td></tr>
<tr class="memdesc:a77af418d9dbd560b4745dc16133deeef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs xfer in async mode using buffers set previously.  <a href="#a77af418d9dbd560b4745dc16133deeef">More...</a><br /></td></tr>
<tr class="separator:a77af418d9dbd560b4745dc16133deeef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14978f17e02f910fc67a2f870e3901cb"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a14978f17e02f910fc67a2f870e3901cb">trigger_xfer</a> ()</td></tr>
<tr class="memdesc:a14978f17e02f910fc67a2f870e3901cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Triggers continued or deferred xfer in async mode.  <a href="#a14978f17e02f910fc67a2f870e3901cb">More...</a><br /></td></tr>
<tr class="separator:a14978f17e02f910fc67a2f870e3901cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35e2a746c65fa95a7f96028e5bccab9d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classecl_1_1generic__bus.html#a35e2a746c65fa95a7f96028e5bccab9d">cancel_xfer</a> ()</td></tr>
<tr class="memdesc:a35e2a746c65fa95a7f96028e5bccab9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cancels xfer.  <a href="#a35e2a746c65fa95a7f96028e5bccab9d">More...</a><br /></td></tr>
<tr class="separator:a35e2a746c65fa95a7f96028e5bccab9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;class PBus&gt;<br />
class ecl::generic_bus&lt; PBus &gt;</h3>

<p>Generic bus interface. </p>
<p>The generic bus is useful adapter, that allows to:</p><ul>
<li>Encapsulate locking policy when multithreaded environment is used.</li>
<li>Hide differences between full-duplex and half-duplex busses.</li>
<li>Define and simplify platform-level bus interface <dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">PBus</td><td>Platform-level bus driver (I2C, SPI, etc.)</td></tr>
  </table>
  </dd>
</dl>
This class uses one of methods to prevent “static initialization order fiasco” to handle initialization of the static members. See <a href="https://isocpp.org/wiki/faq/ctors">https://isocpp.org/wiki/faq/ctors</a> </li>
</ul>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a9a48ce41c43cd645b9a16b14f77c38c0"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::<a class="el" href="classecl_1_1generic__bus.html#a9a48ce41c43cd645b9a16b14f77c38c0">platform_handle</a> =  PBus</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Exported platform bus type. </p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a81353b994dedb7eadbb1a541da18354c"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::<a class="el" href="classecl_1_1generic__bus.html">generic_bus</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construction is not allowed. </p>

</div>
</div>
<a class="anchor" id="aed14e010e70ab6b6a2da294a52e722b3"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::~<a class="el" href="classecl_1_1generic__bus.html">generic_bus</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a35e2a746c65fa95a7f96028e5bccab9d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::cancel_xfer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cancels xfer. </p>
<p>Capable of cancelling any previously started or scheduled xfer. Keeps buffer and callback configured. Callable from ISR context. </p><dl class="section pre"><dt>Precondition</dt><dd>Bus locked, xfer started or scheduled. If bus is unlocked, behaviour is undefined. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>Decide how platform bus should behave if <a class="el" href="classecl_1_1generic__bus.html#a35e2a746c65fa95a7f96028e5bccab9d" title="Cancels xfer. ">cancel_xfer()</a> called from ISR. Is platform bus should generate 'transfer complete' event? </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Xfer canceled, but buffers is not touched. Note that xfer can be ongoing or even completed during this call. </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_a35e2a746c65fa95a7f96028e5bccab9d_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_a35e2a746c65fa95a7f96028e5bccab9d_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_a35e2a746c65fa95a7f96028e5bccab9d_cgraph" id="classecl_1_1generic__bus_a35e2a746c65fa95a7f96028e5bccab9d_cgraph">
<area shape="rect" id="node2" href="namespaceecl.html#a6192e1fbb0daae97ed24c85e1497e772" title="ecl::is_ok" alt="" coords="308,56,391,83"/>
<area shape="rect" id="node5" href="classecl_1_1binary__semaphore.html#ab6af72a433656867b1cae23da60fcae5" title="Signals a semaphore. " alt="" coords="264,129,435,170"/>
<area shape="rect" id="node3" href="namespaceecl.html#a9cad3f0245d7c13ec8d2bdece0cebcd8" title="ecl::is_error" alt="" coords="527,5,625,32"/>
<area shape="rect" id="node4" href="namespaceecl.html#af38a3e6192880841a2e1206268a3d355" title="ecl::err_to_str" alt="" coords="521,56,631,83"/>
<area shape="rect" id="node6" href="group__stm32__irq.html#ga472287bfc93e3eb21d237bb9c5ecd2d7" title="Checks if a processor is in handler mode of execution at this time. " alt="" coords="521,107,631,133"/>
<area shape="rect" id="node7" href="semphr_8h.html#a2a0dca3ece8f764ed7a026f1ef29fa4d" title="xSemaphoreGive" alt="" coords="509,157,643,184"/>
<area shape="rect" id="node9" href="semphr_8h.html#a755e1fbf96249a8126e4cd6492391a34" title="xSemaphoreGiveFromISR" alt="" coords="483,208,669,235"/>
<area shape="rect" id="node8" href="classhelper__semphr.html#a7406f0e962905a44b090dfeac9ebc938" title="helper_semphr::signal" alt="" coords="717,183,884,209"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0076b1fb7cd7e434a91cdca47542a4b1"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::deinit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>De-inits a bus. </p>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is initied. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>use init counter to measure how many users are inited this bus. </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>Status of operation. </dd></dl>

</div>
</div>
<a class="anchor" id="afad22a26f544e4ceed1acf2d36bc058a"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Inits a bus. </p>
<p>Lazy initialization. Inits an underlying platform bus. </p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>introduce init counter. </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>Status of operation. </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_afad22a26f544e4ceed1acf2d36bc058a_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_afad22a26f544e4ceed1acf2d36bc058a_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_afad22a26f544e4ceed1acf2d36bc058a_cgraph" id="classecl_1_1generic__bus_afad22a26f544e4ceed1acf2d36bc058a_cgraph">
<area shape="rect" id="node2" href="classecl_1_1mutex.html#af5e824674a77242516c988e05b78fb55" title="ecl::mutex::lock" alt="" coords="217,5,344,32"/>
<area shape="rect" id="node3" href="classecl_1_1mutex.html#a5a984445165aed9ba9b7ee58de579950" title="ecl::mutex::unlock" alt="" coords="209,56,352,83"/>
<area shape="rect" id="node4" href="namespaceecl.html#a6192e1fbb0daae97ed24c85e1497e772" title="ecl::is_ok" alt="" coords="239,107,322,133"/>
<area shape="rect" id="node5" href="namespaceecl.html#a9cad3f0245d7c13ec8d2bdece0cebcd8" title="ecl::is_error" alt="" coords="406,81,505,108"/>
<area shape="rect" id="node6" href="namespaceecl.html#af38a3e6192880841a2e1206268a3d355" title="ecl::err_to_str" alt="" coords="400,132,511,159"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abc62668bfb39f7d024cabab8520bd8fb"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Locks a bus. </p>
<p>Any further operations can be executed after call to this function. If previous async xfer is in progress then current thread will be blocked until its finish. </p><dl class="section pre"><dt>Precondition</dt><dd>Bus is inited successfully. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus is locked. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classecl_1_1generic__bus.html#a9a4d33e14bf412be321861a0e410aba0" title="Unlocks a bus. ">unlock()</a> </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_abc62668bfb39f7d024cabab8520bd8fb_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_abc62668bfb39f7d024cabab8520bd8fb_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_abc62668bfb39f7d024cabab8520bd8fb_cgraph" id="classecl_1_1generic__bus_abc62668bfb39f7d024cabab8520bd8fb_cgraph">
<area shape="rect" id="node2" href="classecl_1_1mutex.html#af5e824674a77242516c988e05b78fb55" title="ecl::mutex::lock" alt="" coords="238,5,365,32"/>
<area shape="rect" id="node3" href="classecl_1_1binary__semaphore.html#aeb5aaed10b2e1c125fae567a0b358287" title="Waits a semaphore. " alt="" coords="216,57,387,98"/>
<area shape="rect" id="node4" href="semphr_8h.html#ac7921b82a4135a668147671d5710fb13" title="xSemaphoreTake" alt="" coords="435,64,569,91"/>
<area shape="rect" id="node5" href="classhelper__semphr.html#ae0aa92a92d1a594cdf3f9be9476398b3" title="helper_semphr::try_wait" alt="" coords="617,64,797,91"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a21e058a0ec65ba4e0f16fff023e9c086"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::set_buffers </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets RX and TX buffers and their sizes. </p>
<p>If only TX or RX transaction required, then only one buffer must be passed. All effects from calls to <a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> will be discarded. This API is convenient analog if both buffers are equal in size. </p><dl class="section user"><dt>Side effects:</dt><dd><ul>
<li>Bus will remember all buffers, until <a class="el" href="classecl_1_1generic__bus.html#a9a4d33e14bf412be321861a0e410aba0" title="Unlocks a bus. ">unlock()</a> or <a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> will be called. </li>
</ul>
</dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is locked. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus is ready to execute xfer. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tx</td><td>Data to transmit. If this param is null, then rx must be set. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rx</td><td>Buffer to receive a data. Optional. If this param is null, then tx must be set. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of buffers. Zero is valid size. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a444bcb3a3fcf8389296c49467f27e1d6">err::ok</a></td><td>Buffers successfully set. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a15e757c159904fb372bd77be464a4586">err::inval</a></td><td>Both buffers are null. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a8bc1b2f84252c3df4edd53e4aad097a7">err::busy</a></td><td>Device is still executing async xfer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7874657f5e4b4b7f859b32c110907216"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::set_buffers </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>tx_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>rx_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets RX and TX buffers and their sizes. </p>
<p>If only TX or RX transaction required, then only one buffer must be passed. All effects from calls to <a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> will be discarded. </p><dl class="section user"><dt>Side effects:</dt><dd><ul>
<li>Bus will remember all buffers, until <a class="el" href="classecl_1_1generic__bus.html#a9a4d33e14bf412be321861a0e410aba0" title="Unlocks a bus. ">unlock()</a> or <a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> will be called. </li>
</ul>
</dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is locked. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus is ready to execute xfer. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tx</td><td>Data to transmit. If this param is null, then rx must be set. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rx</td><td>Buffer to receive a data. Optional. If this param is null, then tx must be set. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tx_size</td><td>Size of TX buffer. Zero is valid size. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rx_size</td><td>Size of RX buffer. Zero is valid size. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a444bcb3a3fcf8389296c49467f27e1d6">err::ok</a></td><td>Buffers successfully set. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a15e757c159904fb372bd77be464a4586">err::inval</a></td><td>Both buffers are null. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a8bc1b2f84252c3df4edd53e4aad097a7">err::busy</a></td><td>Device is still executing async xfer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae07b2883293ec5c6bdcaaebffa51b1b1"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::set_buffers </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>fill_byte</em> = <code>0xff</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets TX buffer size and fills it with given byte. </p>
<p>This will instruct a platform bus to send a byte given number of times. It is implementation defined how platform-level bus handles incoming data, <a class="el" href="group__stm32__gpio.html#ggad60cff4932a4d112ce19db3a380774a0ab2f5ff47436671b6e533d8dc3614845d">e.g</a>. it can be splitted into chunks when sending to the destination, if platform bus protocol allows such thing.</p>
<p>In half-duplex case RX will not be performed. If platform bus is in full duplex mode then RX will be executed but RX data will be ignored. </p><dl class="section user"><dt>Side effects</dt><dd><ul>
<li>Bus will remember a buffer, until <a class="el" href="classecl_1_1generic__bus.html#a9a4d33e14bf412be321861a0e410aba0" title="Unlocks a bus. ">unlock()</a> or <a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> will be called. </li>
</ul>
</dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is locked. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus is ready to execute xfer. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of filled buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fill_byte</td><td>Byte which will be sent in TX stream. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a444bcb3a3fcf8389296c49467f27e1d6">err::ok</a></td><td>Buffer successfully set and filled. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a8bc1b2f84252c3df4edd53e4aad097a7">err::busy</a></td><td>Device is still executing async xfer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a14978f17e02f910fc67a2f870e3901cb"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::trigger_xfer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Triggers continued or deferred xfer in async mode. </p>
<p>Method is capable of triggering two types of xfers:</p><ul>
<li>Continuated: triggers a new xfer with the same buffers and handlers that were used during last xfer.</li>
<li>Deferred: triggers the scheduled xfer, such that was defer using <a class="el" href="classecl_1_1generic__bus.html#a4c7eed2b45da51f420d08649f156f253" title="Performs xfer in blocking mode using buffers set previously with optional timeout. ">xfer()</a> call.</li>
</ul>
<p>This method is a kind of a important optimization trick. It is possible to call it from IRQ context. It uses buffers and handlers from previous xfers, so there is no overhead for unneeded assignments. </p><dl class="section pre"><dt>Precondition</dt><dd>Bus is locked, buffers are set and async xfer is either deferred or executed. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Xfer is ongoing. </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_a14978f17e02f910fc67a2f870e3901cb_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_a14978f17e02f910fc67a2f870e3901cb_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_a14978f17e02f910fc67a2f870e3901cb_cgraph" id="classecl_1_1generic__bus_a14978f17e02f910fc67a2f870e3901cb_cgraph">
<area shape="rect" id="node2" href="namespaceecl.html#a9cad3f0245d7c13ec8d2bdece0cebcd8" title="ecl::is_error" alt="" coords="264,5,363,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9a4d33e14bf412be321861a0e410aba0"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::unlock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unlocks a bus. </p>
<p>Any operations beside <a class="el" href="classecl_1_1generic__bus.html#abc62668bfb39f7d024cabab8520bd8fb" title="Locks a bus. ">lock()</a> is not permitted after this method finishes. </p><dl class="section user"><dt>Side effects:</dt><dd><ul>
<li>In block mode all buffers provided with <a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> will be discarded </li>
<li>In async mode if operation still ongoing, buffers will be discarded after operation will finish.</li>
</ul>
</dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is locked. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus is unlocked. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classecl_1_1generic__bus.html#a21e058a0ec65ba4e0f16fff023e9c086" title="Sets RX and TX buffers and their sizes. ">set_buffers()</a> </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_a9a4d33e14bf412be321861a0e410aba0_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_a9a4d33e14bf412be321861a0e410aba0_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_a9a4d33e14bf412be321861a0e410aba0_cgraph" id="classecl_1_1generic__bus_a9a4d33e14bf412be321861a0e410aba0_cgraph">
<area shape="rect" id="node2" href="classecl_1_1mutex.html#a5a984445165aed9ba9b7ee58de579950" title="ecl::mutex::unlock" alt="" coords="232,5,375,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4c7eed2b45da51f420d08649f156f253"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::xfer </td>
          <td>(</td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>sent</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>received</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>std::chrono::milliseconds::max()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Performs xfer in blocking mode using buffers set previously with optional timeout. </p>
<p>If underlying bus works in half-duplex mode then first tx transaction will occur and then rx. Any deferred xfer will be canceled in result of this call and simple, blocking xfer will proceed. </p><dl class="section warning"><dt>Warning</dt><dd>Method uses a semaphore to wait for a bus event (most likely an IRQ event). It means that in bare-metal environment, without RTOS it is implemented as simple spin-lock. Likely that such behavior is unwanted. In order to control event handling, consider using xfer(const handler_fn &amp;handler) overload. </dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is locked and buffers are set. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus remains in the same state. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sent</td><td>Optional. Bytes sent during this xfer. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">received</td><td>Optional. Bytes received during this xfer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout</td><td>Optional. Timeout to wait for operation to complete. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a444bcb3a3fcf8389296c49467f27e1d6">err::ok</a></td><td>Data is sent successfully. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a8bc1b2f84252c3df4edd53e4aad097a7">err::busy</a></td><td>Device is still executing async xfer. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810af98ed07a4d5f50f7de1410d905f1477f">err::io</a></td><td>Transaction started but failed. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a6bd1da51c3edc54d566604a43bdc1dbe">err::timedout</a></td><td>Operation was not completed before timeout hit. </td></tr>
    <tr><td class="paramname">err</td><td>Any other error that can occur in platform bus </td></tr>
  </table>
  </dd>
</dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_a4c7eed2b45da51f420d08649f156f253_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_a4c7eed2b45da51f420d08649f156f253_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_a4c7eed2b45da51f420d08649f156f253_cgraph" id="classecl_1_1generic__bus_a4c7eed2b45da51f420d08649f156f253_cgraph">
<area shape="rect" id="node2" href="classecl_1_1binary__semaphore.html#a7c438223fc11c5d97e69618d4c73c257" title="Tries to wait on semaphore without lock. " alt="" coords="215,5,386,47"/>
<area shape="rect" id="node5" href="namespaceecl.html#a6192e1fbb0daae97ed24c85e1497e772" title="ecl::is_ok" alt="" coords="259,137,342,163"/>
<area shape="rect" id="node8" href="classecl_1_1binary__semaphore.html#aeb5aaed10b2e1c125fae567a0b358287" title="Waits a semaphore. " alt="" coords="215,71,386,112"/>
<area shape="rect" id="node9" href="namespaceecl_1_1os_1_1signal.html#a4d165308499159c21b605a093dc5739d" title="Tries to wait a signal. " alt="" coords="215,187,387,214"/>
<area shape="rect" id="node3" href="semphr_8h.html#ac7921b82a4135a668147671d5710fb13" title="xSemaphoreTake" alt="" coords="435,25,569,51"/>
<area shape="rect" id="node4" href="classhelper__semphr.html#ae0aa92a92d1a594cdf3f9be9476398b3" title="helper_semphr::try_wait" alt="" coords="617,25,797,51"/>
<area shape="rect" id="node6" href="namespaceecl.html#a9cad3f0245d7c13ec8d2bdece0cebcd8" title="ecl::is_error" alt="" coords="453,86,551,113"/>
<area shape="rect" id="node7" href="namespaceecl.html#af38a3e6192880841a2e1206268a3d355" title="ecl::err_to_str" alt="" coords="447,137,557,163"/>
<area shape="rect" id="node10" href="group__stm32__irq.html#ga472287bfc93e3eb21d237bb9c5ecd2d7" title="Checks if a processor is in handler mode of execution at this time. " alt="" coords="447,187,557,214"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a77af418d9dbd560b4745dc16133deeef"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PBus &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810">ecl::err</a> <a class="el" href="classecl_1_1generic__bus.html">ecl::generic_bus</a>&lt; PBus &gt;::xfer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespaceecl.html#ac1d657f13504c88de2aa1f36963fc64f">bus_handler</a> &amp;&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceecl.html#aca4194795dab8d7b9cdafce56172d9ce">async_type</a>&#160;</td>
          <td class="paramname"><em>type</em> = <code><a class="el" href="namespaceecl.html#aca4194795dab8d7b9cdafce56172d9cea516ff1e73f558b0ae701ae4561a63e2c">async_type::immediate</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Performs xfer in async mode using buffers set previously. </p>
<p>If underlying bus works in half-duplex mode then first tx transaction will occur and then rx. When xfer will be done, given handler will be invoked with a type of an event.</p>
<p>It is also possible to postpone xfer, <a class="el" href="group__stm32__gpio.html#ggad60cff4932a4d112ce19db3a380774a0ae1671797c52e15f763380b45e841ec32">i.e</a>. "defer" it and then trigger at will using xfer_trigger() method. See xfer_trigger() for more defails. Any previous deferred xfer will be canceled in result of this call. </p><dl class="section warning"><dt>Warning</dt><dd>Event handler most likely will be executed in ISR context. Pay attention to it. Do not block inside of it or do anything else that can break ISR or impose high interrupt latency. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Bytes transferred are reported via user-supplied handler per each channel (tx, rx) separately. </dd>
<dd>
Errors that occur after transaction has started are reported via user-supplied handler. </dd></dl>
<dl class="section see"><dt>See also</dt><dd>PBus::event </dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>Bus is locked and buffers are set. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Bus remains in the same state. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">handler</td><td>User-supplied event handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">type</td><td>Type of xfer. Possible values are:<ul>
<li><a class="el" href="namespaceecl.html#aca4194795dab8d7b9cdafce56172d9cea516ff1e73f558b0ae701ae4561a63e2c" title="Xfer will be executed as soon as possible. ">async_type::immediate</a>: xfer will be started as soon as possible.</li>
<li><a class="el" href="namespaceecl.html#aca4194795dab8d7b9cdafce56172d9cea43fff3df3fc0b3417c86dc3040fb2d86" title="Xfer going to be deferred until user asks. ">async_type::deferred</a>: xfer will be postponed until xfer_trigger() call </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a444bcb3a3fcf8389296c49467f27e1d6">err::ok</a></td><td>Data is sent successfully. </td></tr>
    <tr><td class="paramname"><a class="el" href="namespaceecl.html#ae35889935b17d1382e0afc3dc87e9810a8bc1b2f84252c3df4edd53e4aad097a7">err::busy</a></td><td>Device is still executing async xfer. </td></tr>
    <tr><td class="paramname">err</td><td>Any other error that can occur in platform bus. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classecl_1_1generic__bus_a77af418d9dbd560b4745dc16133deeef_cgraph.png" border="0" usemap="#classecl_1_1generic__bus_a77af418d9dbd560b4745dc16133deeef_cgraph" alt=""/></div>
<map name="classecl_1_1generic__bus_a77af418d9dbd560b4745dc16133deeef_cgraph" id="classecl_1_1generic__bus_a77af418d9dbd560b4745dc16133deeef_cgraph">
<area shape="rect" id="node2" href="classecl_1_1generic__bus.html#a14978f17e02f910fc67a2f870e3901cb" title="Triggers continued or deferred xfer in async mode. " alt="" coords="215,5,425,32"/>
<area shape="rect" id="node3" href="namespaceecl.html#a9cad3f0245d7c13ec8d2bdece0cebcd8" title="ecl::is_error" alt="" coords="473,5,572,32"/>
</map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="dev_2bus_2export_2dev_2bus_8hpp.html">dev/bus/export/dev/bus.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceecl.html">ecl</a></li><li class="navelem"><a class="el" href="classecl_1_1generic__bus.html">generic_bus</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
